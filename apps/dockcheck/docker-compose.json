{
  "$schema": "../dynamic-compose-schema.json",
  "services": [
    {
      "name": "dockcheck",
      "image": "alpine:latest",
      "isMain": true,
      "internalPort": 8080,
      "user": "root",
      "capAdd": ["NET_ADMIN"],
      "command": [
        "sh",
        "-c",
        "apk add --no-cache bash jq curl && curl -L https://github.com/regclient/regclient/releases/latest/download/regctl-linux-amd64 -o /usr/local/bin/regctl && chmod +x /usr/local/bin/regctl && curl -L https://raw.githubusercontent.com/mag37/dockcheck/main/dockcheck.sh -o /usr/local/bin/dockcheck.sh && chmod +x /usr/local/bin/dockcheck.sh && exec dockcheck.sh $${DOCKCHECK_FLAGS}"
      ],
      "environment": {
        "AUTO_MODE": "${AUTO_MODE}",
        "MAX_ASYNC": "${MAX_ASYNC}",
        "DAYS_OLD": "${DAYS_OLD}",
        "EXCLUDE_CONTAINERS": "${EXCLUDE_CONTAINERS}",
        "ONLY_LABEL": "${ONLY_LABEL}",
        "AUTO_PRUNE": "${AUTO_PRUNE}",
        "EXTRA_FLAGS": "${EXTRA_FLAGS}",
        "DOCKCHECK_FLAGS": "${DOCKCHECK_FLAGS}"
      },
      "volumes": [
        {
          "hostPath": "/var/run/docker.sock",
          "containerPath": "/var/run/docker.sock"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data",
          "containerPath": "/data"
        }
      ],
      "labels": {
        "traefik.enable": "true",
        "traefik.http.routers.dockcheck.rule": "Host({{TRAEFIK_HOSTS}})",
        "traefik.http.routers.dockcheck.entrypoints": "websecure",
        "traefik.http.routers.dockcheck.tls.certresolver": "myresolver",
        "traefik.http.services.dockcheck.loadbalancer.server.port": "8080",
        "runtipi.managed": "true"
      },
      "networks": ["tipi_main_network"],
      "ports": ["${APP_PORT}:8080"],
      "restart": "unless-stopped",
      "logging": {
        "driver": "json-file",
        "options": {
          "max-size": "5m",
          "max-file": "3"
        }
      }
    }
  ],
  "networks": {
    "tipi_main_network": {
      "external": true
    }
  }
}
