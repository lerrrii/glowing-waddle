version: "3.9"
services:
  jackettvpn:
    container_name: jackettvpn
    image: dyonr/jackettvpn:latest
    restart: unless-stopped
    privileged: true
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    ports:
      - "${APP_PORT-9117}:9117"
    volumes:
      - ${APP_DATA_DIR}/data/config:/config
      - ${APP_DATA_DIR}/data/blackhole:/blackhole
    environment:
      - VPN_ENABLED=${VPN_ENABLED-yes}
      - VPN_TYPE=${VPN_TYPE-openvpn}
      - VPN_USERNAME=${VPN_USERNAME}
      - VPN_PASSWORD=${VPN_PASSWORD}
      - WEBUI_PASSWORD=${WEBUI_PASSWORD}
      - LAN_NETWORK=${LAN_NETWORK}
      - NAME_SERVERS=${NAME_SERVERS-1.1.1.1,1.0.0.1}
      - PUID=${PUID-1000}
      - PGID=${PGID-1000}
      - UMASK=${UMASK-002}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL-300}
      - HEALTH_CHECK_SILENT=${HEALTH_CHECK_SILENT-1}
      - ADDITIONAL_PORTS=${ADDITIONAL_PORTS}
    networks:
      - tipi_main_network
    labels:
      traefik.enable: true
      traefik.http.middlewares.jackettvpn-web-redirect.redirectscheme.scheme: https
      traefik.http.services.jackettvpn.loadbalancer.server.port: 9117
      traefik.http.routers.jackettvpn-insecure.rule: Host(`${APP_DOMAIN}`)
      traefik.http.routers.jackettvpn-insecure.entrypoints: web
      traefik.http.routers.jackettvpn-insecure.middlewares: jackettvpn-web-redirect
      traefik.http.routers.jackettvpn.rule: Host(`${APP_DOMAIN}`)
      traefik.http.routers.jackettvpn.entrypoints: websecure
      traefik.http.routers.jackettvpn.tls.certresolver: myresolver
      traefik.http.routers.jackettvpn-local-insecure.rule: Host(`jackettvpn.${LOCAL_DOMAIN}`)
      traefik.http.routers.jackettvpn-local-insecure.entrypoints: web
      traefik.http.routers.jackettvpn-local.rule: Host(`jackettvpn.${LOCAL_DOMAIN}`)
      traefik.http.routers.jackettvpn-local.entrypoints: websecure
      traefik.http.routers.jackettvpn-local.tls: true
      runtipi.managed: true
networks:
  tipi_main_network:
    external: true
